{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": ["config:recommended"],
  "recreateClosed": true,
  "timezone": "UTC",

  "enabledManagers": ["flux", "kubernetes", "helm-values", "dockerfile", "docker-compose"],

  "schedule": ["before 5am on monday", "before 5am on thursday"],
  "prConcurrentLimit": 5,
  "prHourlyLimit": 3,
  "branchPrefix": "renovate/",
  "semanticCommits": "enabled",
  "semanticCommitType": "chore",
  "semanticCommitScope": "deps",
  "commitMessagePrefix": "",
  "gitAuthor": "Renovate Bot <renovate@company.com>",

  "packageRules": [
    {
      "description": "Flux manifests",
      "matchManagers": ["flux"],
      "fileMatch": [
        "clusters/.*\\.ya?ml$",
        "apps/.*\\.ya?ml$",
        "infrastructure/.*\\.ya?ml$",
        "flux-system/.*\\.ya?ml$",
        "base/.*\\.ya?ml$",
        "overlays/.*\\.ya?ml$"
      ],
      "postUpdateOptions": ["fluxReconcile"]
    },
    {
      "description": "Kubernetes manifests",
      "matchManagers": ["kubernetes"],
      "fileMatch": [
        "k8s/.*\\.ya?ml$",
        "kubernetes/.*\\.ya?ml$",
        "manifests/.*\\.ya?ml$",
        "deploy/.*\\.ya?ml$"
      ]
    },
    {
      "description": "Helm values",
      "matchManagers": ["helm-values"],
      "fileMatch": [
        "charts/.+/values\\.ya?ml$"
      ]
    }
  ],

  "hostRules": [
    { "matchHost": "prometheus-community.github.io", "hostType": "helm", "timeout": 60000 },
    { "matchHost": "charts.bitnami.com", "hostType": "helm", "timeout": 60000 },
    { "matchHost": "helm.traefik.io", "hostType": "helm", "timeout": 30000 },
    { "matchHost": "grafana.github.io", "hostType": "helm", "timeout": 60000 },
    { "matchHost": "index.docker.io", "hostType": "docker", "timeout": 120000 },
    { "matchHost": "registry-1.docker.io", "hostType": "docker", "timeout": 120000 },
    { "matchHost": "quay.io", "hostType": "docker", "timeout": 90000 },
    { "matchHost": "gcr.io", "hostType": "docker", "timeout": 90000 },
    { "matchHost": "ghcr.io", "hostType": "docker", "timeout": 90000 }
  ],

  "vulnerabilityAlerts": {
    "enabled": true,
    "labels": ["security", "vulnerability", "urgent"],
    "reviewers": ["@security-team"],
    "schedule": ["at any time"]
  },
  "osvVulnerabilityAlerts": true,

  "dependencyDashboard": true,
  "dependencyDashboardTitle": "Monthly Dependency Dashboard - Flux GitOps",

  "postUpgradeTasks": {
    "commands": [
      "curl -X POST -H 'Content-type: application/json' --data '{\"text\":\"Renovate scan complete for {{repositoryName}}\"}' $SLACK_WEBHOOK_URL"
    ]
  }
}
