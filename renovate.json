{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": ["config:recommended"],
  "recreateClosed": true,
  "timezone": "UTC",
  "platform": "github",
  "includeForks": false,
  "forkProcessing": "disabled",

  "enabledManagers": ["flux", "kubernetes", "helm-values", "dockerfile", "docker-compose"],

  "flux": {
    "enabled": true,
    "postUpdateOptions": ["fluxReconcile"],
    "managerFilePatterns": [
      "/(?:^|/)gotk-components\\.ya?ml$/",
      "/clusters/.+\\.ya?ml$/",
      "/apps/.+\\.ya?ml$/", 
      "/infrastructure/.+\\.ya?ml$/",
      "/flux-system/.+\\.ya?ml$/",
      "/base/.+\\.ya?ml$/",
      "/overlays/.+\\.ya?ml$/",
      "/kustomization\\.ya?ml$/",
      "/\\.(ya?ml)$/"
    ]
  },

  "kubernetes": {
    "enabled": true,
    "managerFilePatterns": [
      "/k8s/.+\\.ya?ml$/",
      "/kubernetes/.+\\.ya?ml$/", 
      "/manifests/.+\\.ya?ml$/",
      "/deploy/.+\\.ya?ml$/"
    ]
  },

  "helm-values": {
    "enabled": true,
    "managerFilePatterns": [
      "/charts/.+/values\\.ya?ml$/"
    ]
  },

  // ğŸ“… Schedule aligned: Dev/Staging early week, Prod mid-week
  "schedule": ["before 5am on monday", "before 5am on thursday"],
  "prConcurrentLimit": 5,
  "prHourlyLimit": 3,
  "branchPrefix": "renovate/",
  "semanticCommits": "enabled",
  "semanticCommitType": "chore",
  "semanticCommitScope": "deps",
  "commitMessagePrefix": "ğŸ“¦ ",
  "gitAuthor": "Renovate Bot <renovate@company.com>",

  "packageRules": [
    {
      "description": "ğŸš¨ Security updates - Immediate action required",
      "matchDepTypes": ["security"],
      "matchPackagePatterns": [".*"],
      "schedule": ["at any time"],
      "prPriority": 20,
      "automerge": false,
      "labels": ["ğŸš¨security", "urgent", "notify-security-team"],
      "reviewers": ["@security-team"],
      "assignees": ["@platform-lead"],
      "prTitle": "ğŸš¨ SECURITY: Update {{depName}} to {{newVersion}}",
      "commitMessagePrefix": "ğŸš¨ security: ",
      "additionalBranchPrefix": "security-"
    },
    
    {
      "description": "âš¡ Flux core system updates",
      "matchManagers": ["flux"],
      "matchDatasources": ["github-releases", "github-tags"],
      "matchPackageNames": [
        "fluxcd/flux2",
        "fluxcd/helm-controller", 
        "fluxcd/kustomize-controller",
        "fluxcd/notification-controller",
        "fluxcd/source-controller"
      ],
      "schedule": ["before 5am on monday"],
      "postUpdateOptions": ["fluxReconcile"],
      "additionalBranchPrefix": "flux-core-",
      "prPriority": 15,
      "automerge": false,
      "labels": ["flux-core-update", "critical", "notify-platform-team"],
      "reviewers": ["@platform-team"],
      "prTitle": "âš¡ Flux Core: Update {{depName}} to {{newVersion}}",
      "commitMessagePrefix": "âš¡ flux-core: "
    },
    
    {
      "description": "ğŸ”§ Regular Flux updates with reconciliation",
      "matchManagers": ["flux"],
      "excludePackageNames": [
        "fluxcd/flux2",
        "fluxcd/helm-controller", 
        "fluxcd/kustomize-controller",
        "fluxcd/notification-controller",
        "fluxcd/source-controller"
      ],
      "postUpdateOptions": ["fluxReconcile"],
      "additionalBranchPrefix": "flux-",
      "labels": ["flux-update", "gitops", "notify-devops-team"],
      "reviewers": ["@devops-team"],
      "prTitle": "ğŸ”§ Flux: Update {{depName}} to {{newVersion}}",
      "commitMessagePrefix": "ğŸ”§ flux: "
    },
    
    {
      "description": "ğŸ›¡ï¸ Critical Helm charts - Manual review required",
      "matchDatasources": ["helm"],
      "matchPackageNames": [
        "cert-manager",
        "ingress-nginx",
        "prometheus", 
        "grafana",
        "vault",
        "istio-base",
        "istiod",
        "external-dns"
      ],
      "automerge": false,
      "labels": ["critical-helm-update", "manual-review", "notify-platform-team"],
      "reviewers": ["@platform-team", "@senior-devs"],
      "prPriority": 10,
      "prTitle": "ğŸ›¡ï¸ Critical Helm: Update {{depName}} to {{newVersion}}",
      "commitMessagePrefix": "ğŸ›¡ï¸ helm-critical: "
    },

    {
      "description": "ğŸŸ¢ Helm minor/patch auto-merge for staging",
      "matchDatasources": ["helm"],
      "matchUpdateTypes": ["minor", "patch"],
      "matchPaths": ["clusters/staging/**", "clusters/dev/**"],
      "excludePackageNames": [
        "cert-manager", "ingress-nginx", "prometheus", 
        "grafana", "vault", "istio-base", "istiod"
      ],
      "schedule": ["before 5am on monday"],
      "groupName": "helm-staging-auto",
      "groupSlug": "helm-staging",
      "automerge": true,
      "automergeType": "pr",
      "platformAutomerge": true,
      "labels": ["helm-auto-update", "staging", "auto-merged"],
      "prTitle": "ğŸŸ¢ Helm Auto: Update {{depName}} to {{newVersion}}",
      "commitMessagePrefix": "ğŸŸ¢ helm-auto: "
    }
  ],

  "hostRules": [
    { "matchHost": "prometheus-community.github.io", "hostType": "helm", "timeout": 60000 },
    { "matchHost": "charts.bitnami.com", "hostType": "helm", "timeout": 60000 },
    { "matchHost": "helm.traefik.io", "hostType": "helm", "timeout": 30000 },
    { "matchHost": "grafana.github.io", "hostType": "helm", "timeout": 60000 },
    { "matchHost": "index.docker.io", "hostType": "docker", "timeout": 120000 },
    { "matchHost": "registry-1.docker.io", "hostType": "docker", "timeout": 120000 },
    { "matchHost": "quay.io", "hostType": "docker", "timeout": 90000 },
    { "matchHost": "gcr.io", "hostType": "docker", "timeout": 90000 },
    { "matchHost": "ghcr.io", "hostType": "docker", "timeout": 90000 }
  ],

  "vulnerabilityAlerts": {
    "enabled": true,
    "labels": ["security", "vulnerability", "urgent"],
    "reviewers": ["@security-team"],
    "schedule": ["at any time"]
  },
  "osvVulnerabilityAlerts": true,

  "dependencyDashboard": true,
  "dependencyDashboardTitle": "ğŸ“Š Monthly Dependency Dashboard - Flux GitOps",
  "dependencyDashboardHeader": "## ğŸ—“ï¸ Monthly Dependency Scan Results\n\n**Last Scan:** {{date}}\n**Next Scheduled Scan:** First Monday of next month\n\n### ğŸ“ˆ Update Categories\n- ğŸš¨ **Security**: Immediate action required\n- ğŸ”´ **Major**: Breaking changes possible - Manual review\n- ğŸ”¶ **Production**: Requires production team approval\n- ğŸŸ¢ **Auto-merge**: Safe updates for staging/dev\n\n### ğŸ¯ Action Items\n- Review all items marked with âš ï¸\n- Security updates have highest priority\n- Production updates scheduled for business hours\n\n---",
  "dependencyDashboardFooter": "---\n\n### ğŸ“‹ Monthly Statistics\n- **Total Updates Available:** {{totalUpdates}}\n- **Auto-merged:** {{autoMerged}}\n- **Pending Review:** {{pendingReview}}\n- **Security Alerts:** {{securityAlerts}}\n\nğŸ’¡ **Tip:** Enable notifications in Slack/Teams for real-time updates\n\nğŸ”— **Resources:**\n- [Renovate Dashboard]({{dashboardUrl}})\n- [Security Policy](https://company.com/security-policy)\n- [Deployment Runbook](https://company.com/deployment-guide)",

  "assignees": ["@platform-lead"],
  "reviewers": ["@devops-team"],
  "labels": ["dependencies", "automated-update"],

  "separateMinorPatch": false,
  "separateMajorMinor": true,
  "separateMultipleMajor": true,
  "minimumReleaseAge": "3 days",
  "stabilityDays": 3,
  "respectLatest": true,
  "rangeStrategy": "bump",

  "logLevel": "info",
  "onboarding": false,
  "requireConfig": "required",
  "persistRepoData": true,

  // ğŸ”” Slack notification example
  "postUpgradeTasks": {
    "commands": [
      "curl -X POST -H 'Content-type: application/json' --data '{\"text\":\"ğŸ“¢ Renovate scan complete for {{repositoryName}}\"}' $SLACK_WEBHOOK_URL"
    ]
  }
}
